@model _2211_Final_Project_TGM_Blog.Models.Forum.ForumThread

@{
    ViewData["Title"] = "Thread Details";
}

<div class="container mt-4">
    <a asp-action="Index" asp-controller="Category" class="btn btn-secondary mt-3">Back to Categories</a>

    <div class="card">
        <div class="card-body">
            <h2 class="card-title">@Model.Title</h2>
            <p class="card-text">Created at: @Model.CreatedAt</p>
        </div>
    </div>

    <hr />

    <h3>Posts</h3>

    @if (Model.Posts != null && Model.Posts.Any())
    {
        @foreach (var post in Model.Posts)
        {
            <div class="card mt-3">
                <div class="card-body">
                    <p class="card-text">@post.Content</p>
                    @if (post.ImageData != null && post.ImageData.Length > 0)
                    {
                        <img src="@post.ImageData"
                             alt="Blog Image"
                             class="card-img-top img-fluid mb-2" />
                    }
                    <p class="card-text text-muted">Posted by: @post.UserId</p>
                    <p class="card-text text-muted">Posted at: @post.CreatedAt</p>
                    @if (User.IsInRole("Admin"))
                    {
                        <form asp-action="DeleteConfirmed" asp-controller="Post" asp-route-id="@post.Id" method="post" class="delete-form">
                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                    }
                </div>
            </div>
        }
    }
    else
    {
        <p>No posts in this thread yet.</p>
    }
</div>

<!-- Button to toggle send post form -->
<button id="toggleFormBtn" class="btn btn-primary btn-toggle fixed-bottom" style="left: 20px; bottom: 300px;">Create Post Toggle</button>

<!-- Form for sending a message -->
<div id="sendPostForm" class="container mt-3 mb-5 hidden">
    <div class="card">
        <div class="card-body">
            <form method="post" action="@Url.Action("Create", "Post")" enctype="multipart/form-data">
                @Html.AntiForgeryToken()

                <div class="form-group mb-3">
                    <label for="content">Message:</label>
                    <textarea id="content" name="Content" class="form-control" rows="3"></textarea>
                </div>

                <div class="form-group mb-3">
                    <label for="image">Image:</label>
                    <input type="file" id="image" name="Image" class="form-control-file">
                </div>

                <input type="hidden" name="ThreadId" value="@Model.Id">
                <input type="hidden" name="UserId" value="@User.Identity.Name">

                <button type="submit" class="btn btn-primary">Send Message</button>
            </form>
        </div>
    </div>
</div>

@* JavaScript to toggle the visibility of the send post form *@
<script>
    document.getElementById('toggleFormBtn').addEventListener('click', function () {
        var form = document.getElementById('sendPostForm');
        if (!form.classList.contains('hidden')) {
            form.classList.add('fixed-bottom');
            form.classList.add('hidden');
        } else {
            form.classList.remove('fixed-bottom');
            form.classList.remove('hidden');
        }
    });
</script>